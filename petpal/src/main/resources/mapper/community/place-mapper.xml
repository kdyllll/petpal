<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="place">
  <resultMap type="place" id="placeMap">
	<result column="position" property="position" typeHandler="strArr"/>
</resultMap>
  <insert id="insertPlace" parameterType="place">
  	INSERT INTO PLACE VALUES('P'||SEQ_PLACENO.NEXTVAL,#{memberNo},#{title},#{explanation},DEFAULT,#{category},#{position,typeHandler=strArr},DEFAULT)
  	<selectKey keyProperty="placeNo" resultType="string" order="AFTER"><!-- 본쿼리문을 실행하기전이나 후에 특정한값을 가져올때 사용 -->
  		SELECT 'P'||SEQ_PLACENO.CURRVAL FROM DUAL
  	</selectKey>
  </insert>
  <insert id="insertPlaceImg" parameterType="placeImg">
  	INSERT INTO PLACEIMG VALUES('PI'||SEQ_PLACEIMGNO.NEXTVAL,#{placeNo},#{content},#{fileName},
  				<choose>
			 		<when test="type != null">
			 			#{type}
			 		</when>
			 		<when test="type == null">
			 			DEFAULT
			 		</when>
			 	</choose>)
  </insert>
  <insert id="insertHashtag" parameterType="map">
  	INSERT INTO HASHTAG VALUES(#{postNo},#{hashContent})
  </insert>
  <select id="placeList" resultType="place" parameterType="string" resultMap="placeMap">
  	SELECT * FROM PLACE JOIN PLACEIMG USING(PLACENO) JOIN MEMBER USING(MEMBERNO) WHERE TYPE='M'
  	 <if test="value !=null">
  		AND CATEGORY=#{value}
  	</if> 
  </select>
  <select id="selectPlace" resultType="place" parameterType="string" resultMap="placeMap" >
  	SELECT * FROM PLACEIMG JOIN PLACE USING(PLACENO) JOIN MEMBER USING(MEMBERNO) WHERE PLACENO=#{placeNo}
  </select>
  <select id="selectCount" resultType="_int" parameterType="string">
  	SELECT COUNT(*) FROM PLACE
  	 <if test="value !=null">
  		WHERE CATEGORY=#{value}
  	</if> 
  </select>
  <select id="commentCount" resultType="_int" parameterType="string">
  	SELECT COUNT(*) FROM PLACECOMMENT WHERE PLACENO=#{placeNo)
  </select>
  <insert id="insertComment" parameterType="placeComment">
  	INSERT INTO PLACECOMMENT VALUES('PC'||SEQ_PLACECOMMENTNO.NEXTVAL,#{placeNo},#{memberNo},#{commentLevel},#{placeComment},#{commentRef},default)
  </insert>
  <select id="commentList" resultType="placeComment" parameterType="string">
  	SELECT * FROM PLACECOMMENT JOIN MEMBER USING(MEMBERNO) WHERE PLACENO=#{placeNo}
  </select>
</mapper>
